sudo: false
dist: trusty
language: cpp
addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - llvm-toolchain-trusty-5.0
    packages:
      - gcc-7
      - clang-5.0
      - zlib1g-dev
      - libqt4-opengl-dev
      - python3
      - python-pip
      - python3-pip
compiler:
  - clang-5.0
  - gcc-7
env:
  - py=python2 test=sphinx
  - py=python3 test=sphinx
  - py=null test=memalign
  - py=python2 test=pylint
  - py=python3 test=pylint
  - py=python2 test=build
  - py=python3 test=build
matrix:
  exclude:
    - compiler: gcc-7
      env: test=sphinx
    - compiler: gcc-7
      env: test=memalign
    - compiler: gcc-7
      env: test=pylint
    - compiler: gcc-7
      env: py=python2
      env: test=build
install:
  - export NUMBER_OF_PROCESSORS=4
  - export PATH=`pwd`/bin:${PATH}
  - export PYTHONPATH=`pwd`/lib:${PYTHONPATH}
  - export EIGEN_CFLAGS=-I`pwd`/../eigen
  - (cd ..; hg clone https://bitbucket.org/eigen/eigen/; cd eigen; hg update 3.3)
  - pip install urllib3[secure]
  - pip install --user pylint recommonmark sphinx sphinx-rtd-theme
  - pip3 install --user pylint recommonmark sphinx sphinx-rtd-theme
script:
  - ./travis.sh
after_failure:
  - if [ ${test} = "sphinx" ]; then
        cat sphinx.log;
    elif [ ${test} = "memalign" ]; then
        cat memalign.log;
    elif [ ${test} = "pylint" ]; then
        cat pylint.log;
    else
        cat configure.log;
        cat build.log;
        cat testing.log;
        cat gitdiff.log;
    fi
  - sleep 10
