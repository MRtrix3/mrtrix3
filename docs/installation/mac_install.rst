=============
MacOS X installation
=============

We outline the steps for installing *MRtrix3* on MacOS X. Please consult 
:ref:`mac_trouble_shooting` if you encounter any issues with the configure, build
or runtime operations of *MRtrix3*.

Check requirements
------------------

To install *MRtrix3* , you will need the following:

-  a `C++11 <https://en.wikipedia.org/wiki/C%2B%2B11>`__ compliant
   compiler (e.g. `clang <http://clang.llvm.org/>`__ in Xcode)
-  `Python <https://www.python.org/>`__ version >= 2.6 (already included in MacOS X)
-  The `zlib <http://www.zlib.net/>`__ compression library (already included in MacOS X)
-  `Eigen <http://eigen.tuxfamily.org/>`__ version 3
-  `Qt <http://www.qt.io/>`__ version >= 5.1 *[GUI components only]* -
   important: versions prior to this will *not* work

.. WARNING:: 
    To run the GUI components of *MRtrix3*  (``mrview`` & ``shview``), you will also need:

    -  an `OpenGL <https://en.wikipedia.org/wiki/OpenGL>`__ 3.3 compliant graphics card and corresponding software driver - thankfully OpenGL 3.3 is supported across the entire MacOS X range with OS versions >= 10.9.

Install Dependencies
--------------------

-  Update MacOS X to version 10.9 (Mavericks) or higher - OpenGL 3.3 will
   typically not work on older versions

-  Install XCode from the Apple Store

-  Install Eigen - since Eigen is provided as header files only, it's
   probably easiest to just `download the source code <http://eigen.tuxfamily.org/>`__.
   Alternatively, install through `MacPorts <http://www.macports.org/>`__ or 
   `Homebrew <http://brew.sh/>`__ (``brew install eigen``).

-  Download and install `the latest version of
   Qt5 <http://download.qt.io/official_releases/qt/>`__ - you need to
   select the file labelled ``qt-opensource-mac-x64-clang-5.X.X.dmg``.
   Note that you need to use at least Qt 5.1, since earlier versions
   don't support OpenGL 3.3. We advise you to use the latest version
   (5.5.0 as of the last update). You can choose to install it
   system-wide or just in your home folder, whichever suits - just
   remember where you installed it. If you installed Qt via homebrew
   (``brew install qt5``) you should find the Qt5 tools in
   ```brew --prefix`/Cellar/qt5/5.X.X/bin``.

Git setup
---------

Set up your git environment as per the `Git instructions
page <https://help.github.com/articles/set-up-git/#setting-up-git>`__

Build *MRtrix3* 
-------------

1. Clone the *MRtrix3*  repository:

   ::

       git clone https://github.com/MRtrix3/mrtrix3.git

   or if you have set up your SSH keys (for collaborators):

   ::

       git clone git@github.com:MRtrix3/mrtrix3.git

2. Make sure the Qt5 tools are in your PATH, and also the Eigen ones if
   not in a standard location (edit as appropriate):

   ::

       export PATH=/path/to/Qt5/5.X.X/clang_64/bin:$PATH

3. Configure the MRtrix install:

   ::

       cd mrtrix3
       ./configure

   If this does not work, examine the 'configure.log' file that is
   generated by this step, it may give clues as to what went wrong.

4. Build the binaries:

   ::

       ./build

Set up *MRtrix3* 
--------------

1. Set your PATH in the shell startup file:

   ::

       echo PATH=$(pwd)/release/bin:$(pwd)/scripts:\$PATH >> ~/.bashrc

2. Close the terminal and start another one to ensure the startup file
   is read (or just type 'bash')

3. type ``mrview`` to check that everything works

4. You may also want to have a look through the :ref:`mrtrix_config_options` and set anything you think
   might be required on your system.

Keeping *MRtrix3*  up to date
--------------------------

1. You can update your installation at any time by opening a Git Bash
   terminal in the *MRtrix3*  folder, and typing:

   ::

       git pull
       ./build

2. If this doesn't work immediately, it may be that you need to re-run
   the configure script:

   ::

       ./configure

   and re-run step 1 again.

.. _mac_trouble_shooting:

Troubleshooting
-----

Below is a list of problems that you may encounter during installation
or running of *MRtrix3*, along with suggested solutions.


.. ATTENTION::
    This section is incomplete

Conflicts with previous versions of Qt
^^^^^^^^^

If previous versions of Qt were already installed on the system, they
can sometimes conflict with the installation of *MRtrix3*. This can
manifest in many ways, but the two most obvious one are:

-  ``./configure`` reports using the older version, but ``./build``
   completes without errors. However, MRView crashes, complaining about
   OpenGL version not being sufficient.
-  ``./configure`` reports the correct version of Qt, but ``./build``
   fails with various error messages (typically related to refined
   macros, with previous definitions elsewhere in the code).


