find_program(BASH bash)

include(DirsToUnix)
set(EXEC_DIRS ${CMAKE_CURRENT_BINARY_DIR})
list(APPEND EXEC_DIRS ${PROJECT_BINARY_DIR}/bin)
list(APPEND EXEC_DIRS ${PROJECT_BINARY_DIR}/testing/tools)
list(APPEND EXEC_DIRS "$ENV{PATH}")
dirs_to_unix(EXEC_DIRS "${EXEC_DIRS}")

include(BashTests)
function(add_cpp_cmd_test file_path)
    set(extra_labels "")
    foreach(label ${ARGN})
        list(APPEND extra_labels ${label})
    endforeach()

    # Set folder name
    string(REPLACE "/" ";" folder_list ${file_path})
    list(GET folder_list 0 folder_name)

    add_bash_test(
        FILE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/tests/${file_path}"
        PREFIX "${folder_name}"
        WORKING_DIRECTORY ${BINARY_DATA_DIR}
        EXEC_DIRECTORIES "${EXEC_DIRS}"
        LABELS "cpp;command;${folder_name};${extra_labels}"
    )
endfunction()

add_cpp_cmd_test(5tt2gmwmi/default)

add_cpp_cmd_test(5tt2vis/default)

add_cpp_cmd_test(5ttedit/default)

add_cpp_cmd_test(amp2sh/default)

add_cpp_cmd_test(connectomeedit/lower_triangular_from_asymmetric)
add_cpp_cmd_test(connectomeedit/lower_triangular_from_lower_triangular)
add_cpp_cmd_test(connectomeedit/lower_triangular_from_symmetric)
add_cpp_cmd_test(connectomeedit/lower_triangular_from_upper_triangular)
add_cpp_cmd_test(connectomeedit/symmetric_from_asymmetric)
add_cpp_cmd_test(connectomeedit/symmetric_from_lower_triangular)
add_cpp_cmd_test(connectomeedit/symmetric_from_symmetric)
add_cpp_cmd_test(connectomeedit/symmetric_from_upper_triangular)
add_cpp_cmd_test(connectomeedit/transpose)
add_cpp_cmd_test(connectomeedit/upper_triangular_from_asymmetric)
add_cpp_cmd_test(connectomeedit/upper_triangular_from_lower_triangular)
add_cpp_cmd_test(connectomeedit/upper_triangular_from_symmetric)
add_cpp_cmd_test(connectomeedit/upper_triangular_from_upper_triangular)
add_cpp_cmd_test(connectomeedit/zero_diagonal)

add_cpp_cmd_test(dirgen/cartesian)
add_cpp_cmd_test(dirgen/default)
add_cpp_cmd_test(dirgen/power)
add_cpp_cmd_test(dirgen/unipolar)

add_cpp_cmd_test(dirmerge/onesubset)
add_cpp_cmd_test(dirmerge/twosubsets)
add_cpp_cmd_test(dirmerge/foursubsets)
add_cpp_cmd_test(dirmerge/onesubset_firstisfirst)
add_cpp_cmd_test(dirmerge/twosubsets_firstisfirst)
add_cpp_cmd_test(dirmerge/foursubsets_firstisfirst)

add_cpp_cmd_test(dirrotate/default)
add_cpp_cmd_test(dirrotate/onerotation)

add_cpp_cmd_test(dwi2adc/default)

add_cpp_cmd_test(dwi2fod/csd_default)
add_cpp_cmd_test(dwi2fod/csd_lmax)
add_cpp_cmd_test(dwi2fod/csd_masked)
add_cpp_cmd_test(dwi2fod/msmt_default)
add_cpp_cmd_test(dwi2fod/msmt_masked)

add_cpp_cmd_test(dwi2tensor/bzero)
add_cpp_cmd_test(dwi2tensor/default)
add_cpp_cmd_test(dwi2tensor/dkt_constrained)
add_cpp_cmd_test(dwi2tensor/dkt_unconstrained)
add_cpp_cmd_test(dwi2tensor/iters)
add_cpp_cmd_test(dwi2tensor/masked)
add_cpp_cmd_test(dwi2tensor/ols)

add_cpp_cmd_test(dwidenoise/default)
add_cpp_cmd_test(dwidenoise/exp1_estimator)
add_cpp_cmd_test(dwidenoise/extent_anisotropic)
add_cpp_cmd_test(dwidenoise/extent_isotropic)
add_cpp_cmd_test(dwidenoise/masked)
add_cpp_cmd_test(dwidenoise/noise_default)
add_cpp_cmd_test(dwidenoise/noise_extent)

add_cpp_cmd_test(dwiextract/bzero)
add_cpp_cmd_test(dwiextract/default)

add_cpp_cmd_test(fixel2peaks/input_afd)
add_cpp_cmd_test(fixel2peaks/input_directions)
add_cpp_cmd_test(fixel2peaks/input_directory)
add_cpp_cmd_test(fixel2peaks/input_index)

add_cpp_cmd_test(fixel2sh/default)
add_cpp_cmd_test(fixel2sh/lmax)

add_cpp_cmd_test(fixel2tsf/default)

add_cpp_cmd_test(fixel2voxel/absmax)
add_cpp_cmd_test(fixel2voxel/complexity)
add_cpp_cmd_test(fixel2voxel/count)
add_cpp_cmd_test(fixel2voxel/dec_scaled)
add_cpp_cmd_test(fixel2voxel/dec_unit)
add_cpp_cmd_test(fixel2voxel/magmax)
add_cpp_cmd_test(fixel2voxel/max)
add_cpp_cmd_test(fixel2voxel/mean)
add_cpp_cmd_test(fixel2voxel/min)
add_cpp_cmd_test(fixel2voxel/none)
add_cpp_cmd_test(fixel2voxel/product)
add_cpp_cmd_test(fixel2voxel/sf)
add_cpp_cmd_test(fixel2voxel/sum)

add_cpp_cmd_test(fixelcfestats/default)
add_cpp_cmd_test(fixelcfestats/legacy)
add_cpp_cmd_test(fixelcfestats/masked)

add_cpp_cmd_test(fixelconnectivity/masked)
add_cpp_cmd_test(fixelconnectivity/weighted)

add_cpp_cmd_test(fixelconvert/new_to_old)
add_cpp_cmd_test(fixelconvert/old_to_new)

add_cpp_cmd_test(fixelcorrespondence/default)

add_cpp_cmd_test(fixelcrop/default)

add_cpp_cmd_test(fixelfilter/smooth_inputdir)
add_cpp_cmd_test(fixelfilter/smooth_inputfile)

add_cpp_cmd_test(fixelreorient/default)

add_cpp_cmd_test(fod2dec/anat_combo)
add_cpp_cmd_test(fod2dec/anat_default)
add_cpp_cmd_test(fod2dec/anat_lum)
add_cpp_cmd_test(fod2dec/anat_masked)
add_cpp_cmd_test(fod2dec/anat_noweight)
add_cpp_cmd_test(fod2dec/anat_threshold)
add_cpp_cmd_test(fod2dec/combo)
add_cpp_cmd_test(fod2dec/default)
add_cpp_cmd_test(fod2dec/lum)
add_cpp_cmd_test(fod2dec/masked)
add_cpp_cmd_test(fod2dec/noweight)
add_cpp_cmd_test(fod2dec/threshold)

add_cpp_cmd_test(fod2fixel/default)
add_cpp_cmd_test(fod2fixel/masked)
add_cpp_cmd_test(fod2fixel/nothresholds)

add_cpp_cmd_test(label2colour/freesurfer)
add_cpp_cmd_test(label2colour/iit)
add_cpp_cmd_test(label2colour/random)

add_cpp_cmd_test(label2mesh/blocky)
add_cpp_cmd_test(label2mesh/default)

add_cpp_cmd_test(labelconvert/aal)
add_cpp_cmd_test(labelconvert/freesurfer)
add_cpp_cmd_test(labelconvert/iit)
add_cpp_cmd_test(labelconvert/lpba40)
add_cpp_cmd_test(labelconvert/mismatch)

add_cpp_cmd_test(maskfilter/connect_26connectivity)
add_cpp_cmd_test(maskfilter/connect_26connectivity_largest)
add_cpp_cmd_test(maskfilter/connect_axes)
add_cpp_cmd_test(maskfilter/connect_axes_26connectivity)
add_cpp_cmd_test(maskfilter/connect_default)
add_cpp_cmd_test(maskfilter/connect_largest)
add_cpp_cmd_test(maskfilter/dilate)
add_cpp_cmd_test(maskfilter/erode)
add_cpp_cmd_test(maskfilter/median)

add_cpp_cmd_test(mesh2voxel/default)

add_cpp_cmd_test(meshconvert/big_endian)
add_cpp_cmd_test(meshconvert/little_endian)
add_cpp_cmd_test(meshconvert/obj_ascii)
add_cpp_cmd_test(meshconvert/obj_binary)
add_cpp_cmd_test(meshconvert/stl_ascii)
add_cpp_cmd_test(meshconvert/stl_binary)
add_cpp_cmd_test(meshconvert/transform_first2real)
add_cpp_cmd_test(meshconvert/transform_real2first)
add_cpp_cmd_test(meshconvert/transform_real2voxel)
add_cpp_cmd_test(meshconvert/transform_voxel2real)
add_cpp_cmd_test(meshconvert/vtk_ascii)
add_cpp_cmd_test(meshconvert/vtk_binary)

add_cpp_cmd_test(mraverageheader/mean_nearest)
add_cpp_cmd_test(mraverageheader/mean_projection)
add_cpp_cmd_test(mraverageheader/min_nearest)
add_cpp_cmd_test(mraverageheader/min_projection)
add_cpp_cmd_test(mraverageheader/padding)

add_cpp_cmd_test(mrcalc/calc_mode)
add_cpp_cmd_test(mrcalc/expression_1)
add_cpp_cmd_test(mrcalc/expression_2)
add_cpp_cmd_test(mrcalc/expression_3)
add_cpp_cmd_test(mrcalc/expression_4)
add_cpp_cmd_test(mrcalc/expression_5)

add_cpp_cmd_test(mrcat/axis)
add_cpp_cmd_test(mrcat/single_input)
add_cpp_cmd_test(mrcat/singlevoxel)

add_cpp_cmd_test(mrclusterstats/clustersize)
add_cpp_cmd_test(mrclusterstats/default)
add_cpp_cmd_test(mrclusterstats/legacy)
add_cpp_cmd_test(mrclusterstats/masked)

add_cpp_cmd_test(mrcolour/bothlimits)
add_cpp_cmd_test(mrcolour/map_cool)
add_cpp_cmd_test(mrcolour/map_gray)
add_cpp_cmd_test(mrcolour/map_hot)
add_cpp_cmd_test(mrcolour/map_inferno)
add_cpp_cmd_test(mrcolour/map_jet)
add_cpp_cmd_test(mrcolour/map_pet)
add_cpp_cmd_test(mrcolour/map_rgb)
add_cpp_cmd_test(mrcolour/map_viridis)
add_cpp_cmd_test(mrcolour/scaling)
add_cpp_cmd_test(mrcolour/upperlimit)

add_cpp_cmd_test(mrconvert/big_endian)
add_cpp_cmd_test(mrconvert/coord_end)
add_cpp_cmd_test(mrconvert/format_mgh)
add_cpp_cmd_test(mrconvert/format_mgz)
add_cpp_cmd_test(mrconvert/format_mif_gz)
add_cpp_cmd_test(mrconvert/format_mih)
add_cpp_cmd_test(mrconvert/format_nii)
add_cpp_cmd_test(mrconvert/format_nii_gz)
add_cpp_cmd_test(mrconvert/format_png)
add_cpp_cmd_test(mrconvert/insert_axis)
add_cpp_cmd_test(mrconvert/multifile)
add_cpp_cmd_test(mrconvert/multifile_singlevoxel)
add_cpp_cmd_test(mrconvert/passthrough)
add_cpp_cmd_test(mrconvert/real2complex)
add_cpp_cmd_test(mrconvert/strides)

add_cpp_cmd_test(mrdegibbs/default)

add_cpp_cmd_test(mrfilter/gradient_default)
add_cpp_cmd_test(mrfilter/gradient_magnitude)
add_cpp_cmd_test(mrfilter/gradient_scanner)
add_cpp_cmd_test(mrfilter/gradient_scanner_magnitude)
add_cpp_cmd_test(mrfilter/median_default)
add_cpp_cmd_test(mrfilter/median_extent_anisotropic)
add_cpp_cmd_test(mrfilter/median_extent_isotropic)
add_cpp_cmd_test(mrfilter/smooth_default)
add_cpp_cmd_test(mrfilter/smooth_extent)
add_cpp_cmd_test(mrfilter/smooth_fwhm)
add_cpp_cmd_test(mrfilter/smooth_stdev_3vector)
add_cpp_cmd_test(mrfilter/smooth_stdev_anisotropic)
add_cpp_cmd_test(mrfilter/smooth_stdev_scalar)

add_cpp_cmd_test(mrgrid/crop_axis_range)
add_cpp_cmd_test(mrgrid/crop_axis_widths)
add_cpp_cmd_test(mrgrid/crop_mask_default)
add_cpp_cmd_test(mrgrid/crop_mask_nopadding)
add_cpp_cmd_test(mrgrid/pad_singleaxis)
add_cpp_cmd_test(mrgrid/pad_twoaxes)
add_cpp_cmd_test(mrgrid/pad_uniform)
add_cpp_cmd_test(mrgrid/pad_uniform_plus_singleaxis)
add_cpp_cmd_test(mrgrid/regrid_anisotropic_scale)
add_cpp_cmd_test(mrgrid/regrid_anisotropic_size)
add_cpp_cmd_test(mrgrid/regrid_anisotropic_vox)
add_cpp_cmd_test(mrgrid/regrid_downsample)
add_cpp_cmd_test(mrgrid/regrid_upsample_default)
add_cpp_cmd_test(mrgrid/regrid_upsample_linear)
add_cpp_cmd_test(mrgrid/regrid_upsample_nearest)
add_cpp_cmd_test(mrgrid/regrid_upsample_sinc)

add_cpp_cmd_test(mrhistmatch/linear)
add_cpp_cmd_test(mrhistmatch/scale)

add_cpp_cmd_test(mrhistogram/allvolumes)
add_cpp_cmd_test(mrhistogram/bins)
add_cpp_cmd_test(mrhistogram/default)
add_cpp_cmd_test(mrhistogram/masked)

add_cpp_cmd_test(mrmath/multiimage_median)
add_cpp_cmd_test(mrmath/singleimage_mean)
add_cpp_cmd_test(mrmath/singleimage_norm)
add_cpp_cmd_test(mrmath/singleimage_rms)

add_cpp_cmd_test(mrregister/multicontrast_affine)
add_cpp_cmd_test(mrregister/multicontrast_affine_weights)
add_cpp_cmd_test(mrregister/multicontrast_rigidaffine_fod)
add_cpp_cmd_test(mrregister/multicontrast_rigidnonlinear_fod)
add_cpp_cmd_test(mrregister/singlecontrast_affine)
add_cpp_cmd_test(mrregister/singlecontrast_rigidnonlinear_fod)

add_cpp_cmd_test(mrstats/complex)
add_cpp_cmd_test(mrstats/default)
add_cpp_cmd_test(mrstats/masked)

add_cpp_cmd_test(mrthreshold/3d_4dmask)
add_cpp_cmd_test(mrthreshold/3d_abs)
add_cpp_cmd_test(mrthreshold/3d_bottomcount)
add_cpp_cmd_test(mrthreshold/3d_bottompercent)
add_cpp_cmd_test(mrthreshold/3d_default_noimageout)
add_cpp_cmd_test(mrthreshold/3d_default_withimageout)
add_cpp_cmd_test(mrthreshold/3d_ignorezero)
add_cpp_cmd_test(mrthreshold/3d_lessthan)
add_cpp_cmd_test(mrthreshold/3d_masked)
add_cpp_cmd_test(mrthreshold/3d_median)
add_cpp_cmd_test(mrthreshold/3d_median_masked)
add_cpp_cmd_test(mrthreshold/3d_outmasked)
add_cpp_cmd_test(mrthreshold/3d_topcount)
add_cpp_cmd_test(mrthreshold/3d_toppercent)
add_cpp_cmd_test(mrthreshold/4d_default_noimageout)
add_cpp_cmd_test(mrthreshold/4d_default_withimageout)
add_cpp_cmd_test(mrthreshold/4d_masked)
add_cpp_cmd_test(mrthreshold/4d_median)
add_cpp_cmd_test(mrthreshold/4d_median_masked)
add_cpp_cmd_test(mrthreshold/4d_verify_pervolume)
add_cpp_cmd_test(mrthreshold/allvolumes_default)
add_cpp_cmd_test(mrthreshold/allvolumes_masked)
add_cpp_cmd_test(mrthreshold/allvolumes_median)
add_cpp_cmd_test(mrthreshold/allvolumes_median_masked)

add_cpp_cmd_test(mrtransform/fliplr)
add_cpp_cmd_test(mrtransform/fod_linear_reorient_noresample)
add_cpp_cmd_test(mrtransform/fod_linear_reorient_withresample)
add_cpp_cmd_test(mrtransform/fod_nonlinear)
add_cpp_cmd_test(mrtransform/identity)
add_cpp_cmd_test(mrtransform/linear)
add_cpp_cmd_test(mrtransform/linear_inverse)
add_cpp_cmd_test(mrtransform/linear_template)
add_cpp_cmd_test(mrtransform/noop)
add_cpp_cmd_test(mrtransform/replace)

add_cpp_cmd_test(mtnormalise/default)

add_cpp_cmd_test(peaks2amp/default)

add_cpp_cmd_test(peaks2fixel/default)

add_cpp_cmd_test(sh2amp/default)
add_cpp_cmd_test(sh2amp/grad)
add_cpp_cmd_test(sh2amp/msmt)
add_cpp_cmd_test(sh2amp/nonnegative)

add_cpp_cmd_test(sh2peaks/default)
add_cpp_cmd_test(sh2peaks/fast)

add_cpp_cmd_test(sh2power/default)

add_cpp_cmd_test(sh2response/default)

add_cpp_cmd_test(shbasis/new2new)
add_cpp_cmd_test(shbasis/new2old)
add_cpp_cmd_test(shbasis/old2new)
add_cpp_cmd_test(shbasis/old2old)

add_cpp_cmd_test(shconv/default)
add_cpp_cmd_test(shconv/msmt)

add_cpp_cmd_test(tck2connectome/assignment_forward_search)
add_cpp_cmd_test(tck2connectome/default)

add_cpp_cmd_test(tckconvert/rib_write)
add_cpp_cmd_test(tckconvert/scanner2voxel)
add_cpp_cmd_test(tckconvert/text_read_range)
add_cpp_cmd_test(tckconvert/text_write)
add_cpp_cmd_test(tckconvert/vtk_read_binary)
add_cpp_cmd_test(tckconvert/vtk_read_empty)
add_cpp_cmd_test(tckconvert/vtk_write_ascii)
add_cpp_cmd_test(tckconvert/vtk_write_binary)

add_cpp_cmd_test(tckedit/include_exclude_inverse)
add_cpp_cmd_test(tckedit/include_mask)
add_cpp_cmd_test(tckedit/length)
add_cpp_cmd_test(tckedit/mask)

add_cpp_cmd_test(tckgen/act_terminations)
add_cpp_cmd_test(tckgen/algorithm_ifod2)
add_cpp_cmd_test(tckgen/algorithm_sdstream)
add_cpp_cmd_test(tckgen/algorithm_tensordet)
add_cpp_cmd_test(tckgen/algorithm_tensorprob)
add_cpp_cmd_test(tckgen/backtrack)
add_cpp_cmd_test(tckgen/multithreading)
add_cpp_cmd_test(tckgen/seed_dynamic)
add_cpp_cmd_test(tckgen/seed_gmwmi)
add_cpp_cmd_test(tckgen/seed_grid_per_voxel)
add_cpp_cmd_test(tckgen/seed_image)
add_cpp_cmd_test(tckgen/seed_random_per_voxel)
add_cpp_cmd_test(tckgen/seed_rejection)
add_cpp_cmd_test(tckgen/seed_sphere)

add_cpp_cmd_test(tckmap/dec)
add_cpp_cmd_test(tckmap/default_template)
add_cpp_cmd_test(tckmap/default_vox)
add_cpp_cmd_test(tckmap/tod)

add_cpp_cmd_test(tckresample/downsample)
add_cpp_cmd_test(tckresample/endpoints)
add_cpp_cmd_test(tckresample/num_points)
add_cpp_cmd_test(tckresample/step_size)
add_cpp_cmd_test(tckresample/upsample)

add_cpp_cmd_test(tcksample/precise)
add_cpp_cmd_test(tcksample/statmax)
add_cpp_cmd_test(tcksample/statmean)
add_cpp_cmd_test(tcksample/statmedian)
add_cpp_cmd_test(tcksample/statmin)
add_cpp_cmd_test(tcksample/statnone_text)
add_cpp_cmd_test(tcksample/statnone_tsf)
add_cpp_cmd_test(tcksample/tdifraction)

add_cpp_cmd_test(tcksift/default)

add_cpp_cmd_test(tcksift2/default)

add_cpp_cmd_test(tcktransform/unitwarp)

add_cpp_cmd_test(tensor2metric/adc)
add_cpp_cmd_test(tensor2metric/dkt)
add_cpp_cmd_test(tensor2metric/eigenvalues)
add_cpp_cmd_test(tensor2metric/eigenvectors)
add_cpp_cmd_test(tensor2metric/fa)

add_cpp_cmd_test(transformcalc/average)
add_cpp_cmd_test(transformcalc/header)
add_cpp_cmd_test(transformcalc/interpolate)

add_cpp_cmd_test(transformcompose/affine_nonlinear)
add_cpp_cmd_test(transformcompose/affine_to_image)
add_cpp_cmd_test(transformcompose/two_affines)
add_cpp_cmd_test(transformcompose/two_nonlinear)

add_cpp_cmd_test(transformconvert/flirt_import)
add_cpp_cmd_test(transformconvert/itk_ants)
add_cpp_cmd_test(transformconvert/itk_ants_zero)
add_cpp_cmd_test(transformconvert/itk_slicer)

add_cpp_cmd_test(tsfdivide/default)

add_cpp_cmd_test(tsfmult/default)

add_cpp_cmd_test(tsfsmooth/default)

add_cpp_cmd_test(tsfthreshold/default)
add_cpp_cmd_test(tsfthreshold/invert)

add_cpp_cmd_test(vectorstats/0)
add_cpp_cmd_test(vectorstats/1)
add_cpp_cmd_test(vectorstats/2)
add_cpp_cmd_test(vectorstats/3)
add_cpp_cmd_test(vectorstats/4)

add_cpp_cmd_test(voxel2fixel/default)

add_cpp_cmd_test(warp2metric/fc)
add_cpp_cmd_test(warp2metric/jdet)
add_cpp_cmd_test(warp2metric/jmat)

add_cpp_cmd_test(warpcorrect/default)

add_cpp_cmd_test(warpinit/default)
