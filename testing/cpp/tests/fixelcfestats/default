#!/bin/bash
# Verify operation of command under default parameters
# Ensure that outputs match that generated by a prior software version
# Ensure that statistical significance mask (p<0.05) matches the synthetic effect introduced in the data
rm -rf tmp/

fixelcfestats fixelfilter/smooth/out/ fixelcfestats/subjects.txt fixelcfestats/design.txt fixelcfestats/contrast.txt SIFT_phantom/matrix/ tmp/ -force

for f in abs_effect.mif beta0.mif beta1.mif cfe.mif std_dev.mif std_effect.mif tvalue.mif Zstat.mif; do
    testing_diff_image tmp/$f fixelcfestats/default/$f -abs 1e-6 || exit 1;
done

mrcalc tmp/fwe_1mpvalue.mif 0.95 -gt - | \
testing_diff_image - SIFT_phantom/fixels/upper.mif -abs 1e-6
