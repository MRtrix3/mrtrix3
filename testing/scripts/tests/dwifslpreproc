mkdir -p ../tmp/dwifslpreproc && mrconvert BIDS/sub-04/dwi/sub-04_dwi.nii.gz -fslgrad BIDS/sub-04/dwi/sub-04_dwi.bvec BIDS/sub-04/dwi/sub-04_dwi.bval -json_import BIDS/sub-04/dwi/sub-04_dwi.json tmp-sub-04_dwi.mif -export_grad_mrtrix tmp-sub-04_dwi.b -strides 0,0,0,1 && dwifslpreproc tmp-sub-04_dwi.mif ../tmp/dwifslpreproc/rpenone_default.mif -pe_dir ap -readout_time 0.1 -rpe_none -force && testing_diff_header ../tmp/dwifslpreproc/rpenone_default.mif dwifslpreproc/rpenone_default.mif.gz
dwifslpreproc BIDS/sub-04/dwi/sub-04_dwi.nii.gz -fslgrad BIDS/sub-04/dwi/sub-04_dwi.bvec BIDS/sub-04/dwi/sub-04_dwi.bval ../tmp/dwifslpreproc/fslgrad.mif -export_grad_fsl ../tmp/dwifslpreproc/fslgrad.bvec ../tmp/dwifslpreproc/fslgrad.bval -pe_dir ap -readout_time 0.1 -rpe_none -force && testing_diff_header ../tmp/dwifslpreproc/fslgrad.mif dwifslpreproc/rpenone_default.mif.gz && testing_diff_matrix ../tmp/dwifslpreproc/fslgrad.bvec dwifslpreproc/rpenone_default.bvec -abs 1e-2 && testing_diff_matrix ../tmp/dwifslpreproc/fslgrad.bval dwifslpreproc/rpenone_default.bval
dwifslpreproc BIDS/sub-04/dwi/sub-04_dwi.nii.gz -grad tmp-sub-04_dwi.b ../tmp/dwifslpreproc/grad.mif -export_grad_mrtrix ../tmp/dwifslpreproc/grad.b -pe_dir ap -readout_time 0.1 -rpe_none -force && testing_diff_header ../tmp/dwifslpreproc/grad.mif dwifslpreproc/rpenone_default.mif.gz && testing_diff_matrix ../tmp/dwifslpreproc/grad.b dwifslpreproc/rpenone_default.b -abs 1e-2
mrconvert BIDS/sub-04/fmap/sub-04_dir-1_epi.nii.gz -json_import BIDS/sub-04/fmap/sub-04_dir-1_epi.json tmp-sub-04_dir-1_epi.mif -force && mrconvert BIDS/sub-04/fmap/sub-04_dir-2_epi.nii.gz -json_import BIDS/sub-04/fmap/sub-04_dir-2_epi.json tmp-sub-04_dir-2_epi.mif -force && mrcat tmp-sub-04_dir-1_epi.mif tmp-sub-04_dir-2_epi.mif tmp-sub-04_dir-all_epi.mif -axis 3 -force && dwifslpreproc tmp-sub-04_dwi.mif ../tmp/dwifslpreproc/rpepair_default.mif -pe_dir ap -readout_time 0.1 -rpe_pair -se_epi tmp-sub-04_dir-all_epi.mif -force && testing_diff_header ../tmp/dwifslpreproc/rpepair_default.mif dwifslpreproc/rpepair_default.mif.gz
dwifslpreproc tmp-sub-04_dwi.mif ../tmp/dwifslpreproc/rpepair_align.mif -pe_dir ap -readout_time 0.1 -rpe_pair -se_epi tmp-sub-04_dir-all_epi.mif -align_seepi -force && testing_diff_header ../tmp/dwifslpreproc/rpepair_align.mif dwifslpreproc/rpepair_align.mif.gz
dwifslpreproc tmp-sub-04_dwi.mif ../tmp/dwifslpreproc/eddyqc_text.mif -pe_dir ap -readout_time 0.1 -rpe_pair -se_epi tmp-sub-04_dir-all_epi.mif -eddyqc_text ../tmp/dwifslpreproc/eddyqc_text/ -force
dwifslpreproc tmp-sub-04_dwi.mif ../tmp/dwifslpreproc/eddyqc_all.mif -pe_dir ap -readout_time 0.1 -rpe_pair -se_epi tmp-sub-04_dir-all_epi.mif -eddyqc_all ../tmp/dwifslpreproc/eddyqc_all/ -force
dwifslpreproc tmp-sub-04_dwi.mif ../tmp/dwifslpreproc/rpeheader_default.mif -rpe_header -force && testing_diff_header ../tmp/dwifslpreproc/rpeheader_default.mif dwifslpreproc/rpenone_default.mif.gz
dwifslpreproc BIDS/sub-04/dwi/sub-04_dwi.nii.gz -fslgrad BIDS/sub-04/dwi/sub-04_dwi.bvec BIDS/sub-04/dwi/sub-04_dwi.bval -json_import BIDS/sub-04/dwi/sub-04_dwi.json ../tmp/dwifslpreproc/rpeheader_fslgrad_json.mif -rpe_header -force && testing_diff_header ../tmp/dwifslpreproc/rpeheader_fslgrad_json.mif dwifslpreproc/rpenone_default.mif.gz
dwifslpreproc tmp-sub-04_dwi.mif ../tmp/dwifslpreproc/rpeheader_seepi.mif -rpe_header -se_epi tmp-sub-04_dir-all_epi.mif -force && testing_diff_header ../tmp/dwifslpreproc/rpeheader_seepi.mif dwifslpreproc/rpepair_default.mif.gz
dwifslpreproc tmp-sub-04_dwi.mif ../tmp/dwifslpreproc/rpeheader_singlefmap.mif -rpe_header -se_epi tmp-sub-04_dir-2_epi.mif -align_seepi -force && testing_diff_header ../tmp/dwifslpreproc/rpeheader_singlefmap.mif dwifslpreproc/rpeheader_singlefmap.mif.gz
mrconvert BIDS/sub-05/dwi/sub-05_acq-1_dwi.nii.gz -fslgrad BIDS/sub-05/dwi/sub-05_acq-1_dwi.bvec BIDS/sub-05/dwi/sub-05_acq-1_dwi.bval -json_import BIDS/sub-05/dwi/sub-05_acq-1_dwi.json tmp1.mif -force && mrconvert BIDS/sub-05/dwi/sub-05_acq-2_dwi.nii.gz -fslgrad BIDS/sub-05/dwi/sub-05_acq-2_dwi.bvec BIDS/sub-05/dwi/sub-05_acq-2_dwi.bval -json_import BIDS/sub-05/dwi/sub-05_acq-2_dwi.json tmp2.mif -force && mrcat tmp1.mif tmp2.mif - -axis 3 | mrconvert - tmp-sub-05_dwi.nii -export_grad_mrtrix tmp-sub-05_dwi.b -force && dwifslpreproc tmp-sub-05_dwi.nii -grad tmp-sub-05_dwi.b ../tmp/dwifslpreproc/rpeall.mif -pe_dir ap -readout_time 0.1 -rpe_all -force && testing_diff_header ../tmp/dwifslpreproc/rpeall.mif dwifslpreproc/rpeall.mif.gz
mrcat tmp1.mif tmp2.mif tmp-sub-05_dwi.mif -axis 3 -force && dwifslpreproc tmp-sub-05_dwi.mif ../tmp/dwifslpreproc/rpeheader_rpeall.mif -rpe_header -force && testing_diff_header ../tmp/dwifslpreproc/rpeheader_rpeall.mif dwifslpreproc/rpeall.mif.gz
mrconvert tmp-sub-04_dwi.mif tmp.mif -coord 3 2:67,0,1 -force && dwifslpreproc tmp.mif ../tmp/dwifslpreproc/permuted_volumes.mif -pe_dir ap -readout_time 0.1 -rpe_none -force && testing_diff_header ../tmp/dwifslpreproc/permuted_volumes.mif dwifslpreproc/permuted_volumes.mif.gz
mrconvert tmp-sub-04_dwi.mif tmp.mif -coord 0 0:46 -coord 1 1:47 -force && dwifslpreproc tmp.mif ../tmp/dwifslpreproc/axis_padding.mif -pe_dir ap -readout_time 0.1 -rpe_pair -se_epi tmp-sub-04_dir-all_epi.mif -force && testing_diff_header ../tmp/dwifslpreproc/axis_padding.mif dwifslpreproc/axis_padding.mif.gz
