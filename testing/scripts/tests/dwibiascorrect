mkdir -p ../tmp/dwibiascorrect/ants && mrconvert BIDS/sub-01/dwi/sub-01_dwi.nii.gz -fslgrad BIDS/sub-01/dwi/sub-01_dwi.bvec BIDS/sub-01/dwi/sub-01_dwi.bval tmp-sub-01_dwi.mif -export_grad_mrtrix tmp-sub-01_dwi.b -strides 0,0,0,1 && dwibiascorrect ants tmp-sub-01_dwi.mif ../tmp/dwibiascorrect/ants/default_out.mif -bias ../tmp/dwibiascorrect/ants/default_bias.mif -force && testing_diff_header ../tmp/dwibiascorrect/ants/default_out.mif dwibiascorrect/ants/default_out.mif.gz && testing_diff_header ../tmp/dwibiascorrect/ants/default_bias.mif dwibiascorrect/ants/default_bias.mif.gz
mrconvert tmp-sub-01_dwi.mif - | dwibiascorrect ants - - | testing_diff_header - dwibiascorrect/ants/default_out.mif.gz
dwibiascorrect ants tmp-sub-01_dwi.mif ../tmp/dwibiascorrect/ants/default_out.mif -bias - -force | testing_diff_header - dwibiascorrect/ants/default_bias.mif.gz
dwibiascorrect ants BIDS/sub-01/dwi/sub-01_dwi.nii.gz -fslgrad BIDS/sub-01/dwi/sub-01_dwi.bvec BIDS/sub-01/dwi/sub-01_dwi.bval ../tmp/dwibiascorrect/ants/fslgrad_out.mif -bias ../tmp/dwibiascorrect/ants/fslgrad_bias.mif -force && testing_diff_header ../tmp/dwibiascorrect/ants/fslgrad_out.mif dwibiascorrect/ants/default_out.mif.gz && testing_diff_header ../tmp/dwibiascorrect/ants/fslgrad_bias.mif dwibiascorrect/ants/default_bias.mif.gz
dwibiascorrect ants BIDS/sub-01/dwi/sub-01_dwi.nii.gz -grad tmp-sub-01_dwi.b ../tmp/dwibiascorrect/ants/grad_out.mif -bias ../tmp/dwibiascorrect/ants/grad_bias.mif -force && testing_diff_header ../tmp/dwibiascorrect/ants/grad_out.mif dwibiascorrect/ants/default_out.mif.gz && testing_diff_header ../tmp/dwibiascorrect/ants/grad_bias.mif dwibiascorrect/ants/default_bias.mif.gz
dwibiascorrect ants tmp-sub-01_dwi.mif ../tmp/dwibiascorrect/ants/masked_out.mif -bias ../tmp/dwibiascorrect/ants/masked_bias.mif -mask BIDS/sub-01/dwi/sub-01_brainmask.nii.gz -force && testing_diff_header ../tmp/dwibiascorrect/ants/masked_out.mif dwibiascorrect/ants/masked_out.mif.gz && testing_diff_header ../tmp/dwibiascorrect/ants/masked_bias.mif dwibiascorrect/ants/masked_bias.mif.gz
mrconvert BIDS/sub-01/dwi/sub-01_brainmask.nii.gz - | dwibiascorrect ants tmp-sub-01_dwi.mif ../tmp/dwibiascorrect/ants/masked_out.mif -mask - -force && testing_diff_header ../tmp/dwibiascorrect/ants/masked_out.mif dwibiascorrect/ants/masked_out.mif.gz
mkdir -p ../tmp/dwibiascorrect/fsl && dwibiascorrect fsl tmp-sub-01_dwi.mif ../tmp/dwibiascorrect/fsl/default_out.mif -bias ../tmp/dwibiascorrect/fsl/default_bias.mif -force && testing_diff_header ../tmp/dwibiascorrect/fsl/default_out.mif dwibiascorrect/fsl/default_out.mif.gz && testing_diff_header ../tmp/dwibiascorrect/fsl/default_bias.mif dwibiascorrect/fsl/default_bias.mif.gz
dwibiascorrect fsl BIDS/sub-01/dwi/sub-01_dwi.nii.gz -fslgrad BIDS/sub-01/dwi/sub-01_dwi.bvec BIDS/sub-01/dwi/sub-01_dwi.bval ../tmp/dwibiascorrect/fsl/fslgrad_out.mif -bias ../tmp/dwibiascorrect/fsl/fslgrad_bias.mif -force && testing_diff_header ../tmp/dwibiascorrect/fsl/fslgrad_out.mif dwibiascorrect/fsl/default_out.mif.gz && testing_diff_header ../tmp/dwibiascorrect/fsl/fslgrad_bias.mif dwibiascorrect/fsl/default_bias.mif.gz
dwibiascorrect fsl BIDS/sub-01/dwi/sub-01_dwi.nii.gz -grad tmp-sub-01_dwi.b ../tmp/dwibiascorrect/fsl/grad_out.mif -bias ../tmp/dwibiascorrect/fsl/grad_bias.mif -force && testing_diff_header ../tmp/dwibiascorrect/fsl/grad_out.mif dwibiascorrect/fsl/default_out.mif.gz && testing_diff_header ../tmp/dwibiascorrect/fsl/grad_bias.mif dwibiascorrect/fsl/default_bias.mif.gz
dwibiascorrect fsl tmp-sub-01_dwi.mif ../tmp/dwibiascorrect/fsl/masked_out.mif -bias ../tmp/dwibiascorrect/fsl/masked_bias.mif -mask BIDS/sub-01/dwi/sub-01_brainmask.nii.gz -force && testing_diff_header ../tmp/dwibiascorrect/fsl/masked_out.mif dwibiascorrect/fsl/masked_out.mif.gz && testing_diff_header ../tmp/dwibiascorrect/fsl/masked_bias.mif dwibiascorrect/fsl/masked_bias.mif.gz
mkdir -p ../tmp/dwibiascorrect/mtnorm && dwibiascorrect mtnorm tmp-sub-01_dwi.mif ../tmp/dwibiascorrect/mtnorm/default_out.mif -bias ../tmp/dwibiascorrect/mtnorm/default_bias.mif -force && testing_diff_image ../tmp/dwibiascorrect/mtnorm/default_out.mif dwibiascorrect/mtnorm/default_out.mif.gz -frac 1e-5 && testing_diff_image ../tmp/dwibiascorrect/mtnorm/default_bias.mif dwibiascorrect/mtnorm/default_bias.mif.gz -frac 1e-5
dwibiascorrect mtnorm tmp-sub-01_dwi.mif ../tmp/dwibiascorrect/mtnorm/masked_out.mif -bias ../tmp/dwibiascorrect/mtnorm/masked_bias.mif -mask BIDS/sub-01/dwi/sub-01_brainmask.nii.gz -force && testing_diff_image ../tmp/dwibiascorrect/mtnorm/masked_out.mif dwibiascorrect/mtnorm/masked_out.mif.gz && testing_diff_image ../tmp/dwibiascorrect/mtnorm/masked_bias.mif dwibiascorrect/mtnorm/masked_bias.mif.gz
dwibiascorrect mtnorm tmp-sub-01_dwi.mif -lmax 6,0,0 ../tmp/dwibiascorrect/mtnorm/lmax600_out.mif -bias ../tmp/dwibiascorrect/mtnorm/lmax600_bias.mif -force && testing_diff_image ../tmp/dwibiascorrect/mtnorm/lmax600_out.mif dwibiascorrect/mtnorm/lmax600_out.mif.gz && testing_diff_image ../tmp/dwibiascorrect/mtnorm/lmax600_bias.mif dwibiascorrect/mtnorm/lmax600_bias.mif.gz
