mkdir -p ../tmp/dwishellmath && mrconvert BIDS/sub-01/dwi/sub-01_dwi.nii.gz -fslgrad BIDS/sub-01/dwi/sub-01_dwi.bvec BIDS/sub-01/dwi/sub-01_dwi.bval tmp1.mif -export_grad_mrtrix tmp1.b -force && dwiextract tmp1.mif tmp1_b0.mif -shell 0 -force && dwiextract tmp1.mif tmp1_b1000.mif -shell 1000 -force && dwiextract tmp1.mif tmp1_b2000.mif -shell 2000 -force && dwiextract tmp1.mif tmp1_b3000.mif -shell 3000 -force && mrmath tmp1_b0.mif mean tmp2_b0.mif -axis 3 -force && mrmath tmp1_b1000.mif mean tmp2_b1000.mif -axis 3 -force && mrmath tmp1_b2000.mif mean tmp2_b2000.mif -axis 3 -force && mrmath tmp1_b3000.mif mean tmp2_b3000.mif -axis 3 -force && mrcat tmp2_b0.mif tmp2_b1000.mif tmp2_b2000.mif tmp2_b3000.mif -axis 3 tmp2.mif -force && dwishellmath tmp1.mif mean ../tmp/dwishellmath/default.mif -force && testing_diff_image ../tmp/dwishellmath/default.mif tmp2.mif
dwishellmath BIDS/sub-01/dwi/sub-01_dwi.nii.gz -fslgrad BIDS/sub-01/dwi/sub-01_dwi.bvec BIDS/sub-01/dwi/sub-01_dwi.bval mean ../tmp/dwishellmath/fslgrad.mif -force && testing_diff_image ../tmp/dwishellmath/fslgrad.mif tmp2.mif
dwishellmath BIDS/sub-01/dwi/sub-01_dwi.nii.gz -grad tmp1.b mean ../tmp/dwishellmath/grad.mif -force && testing_diff_image ../tmp/dwishellmath/grad.mif tmp2.mif
dwishellmath tmp1_b3000.mif mean ../tmp/dwishellmath/onebvalue.mif -force
