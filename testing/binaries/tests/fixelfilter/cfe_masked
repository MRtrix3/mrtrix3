#!/bin/bash
# Verify operation of "cfe" filter
#   where a fixel mask is provided to constrain enhancement
# Ensure that output matches expectations:
# - For fixels present in the mask,
#   enhanced values should match those generated by a prior software version
# - Fixels not present in the mask should have a value of 0
fixelfilter SIFT_phantom/fixels/noise.mif cfe tmp.mif -force \
    -matrix SIFT_phantom/matrix \
    -mask SIFT_phantom/fixels/upper.mif
testing_diff_image \
    tmp.mif \
    $(mrcalc SIFT_phantom/fixels/upper.mif fixelfilter/cfe/default.mif 0 -if -) \
    -frac 1e-5
