find_program(BASH bash)

include(DirsToUnix)
set(EXEC_DIRS ${CMAKE_CURRENT_BINARY_DIR})
list(APPEND EXEC_DIRS ${PROJECT_BINARY_DIR}/bin)
list(APPEND EXEC_DIRS ${PROJECT_BINARY_DIR}/testing/tools)
list(APPEND EXEC_DIRS "$ENV{PATH}")
dirs_to_unix(EXEC_DIRS "${EXEC_DIRS}")

include(BashTests)
function(add_python_cmd_test file_path)
    set(extra_labels "")
    foreach(label ${ARGN})
        list(APPEND extra_labels ${label})
    endforeach()

    # Set folder name
    string(REPLACE "/" ";" folder_list ${file_path})
    list(GET folder_list 0 folder_name)

    add_bash_test(
        FILE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/tests/${file_path}"
        PREFIX "${folder_name}"
        WORKING_DIRECTORY ${SCRIPT_DATA_DIR}
        EXEC_DIRECTORIES "${EXEC_DIRS}"
        LABELS "python;command;${folder_name};${extra_labels}"
    )
endfunction()

add_python_cmd_test(5ttgen/deepatropos_fromseg_default "pythonci")
add_python_cmd_test(5ttgen/deepatropos_fromseg_whitestem)
add_python_cmd_test(5ttgen/deepatropos_fromprob_default "pythonci")
add_python_cmd_test(5ttgen/deepatropos_fromprob_whitestem)
add_python_cmd_test(5ttgen/freesurfer_default "pythonci")
add_python_cmd_test(5ttgen/freesurfer_nocrop)
add_python_cmd_test(5ttgen/freesurfer_piping)
add_python_cmd_test(5ttgen/freesurfer_sgmamyghipp)
add_python_cmd_test(5ttgen/freesurfer_whitespace)
add_python_cmd_test(5ttgen/fsl_default)
add_python_cmd_test(5ttgen/fsl_mask)
add_python_cmd_test(5ttgen/fsl_nocrop)
add_python_cmd_test(5ttgen/fsl_piping)
add_python_cmd_test(5ttgen/fsl_premasked)
add_python_cmd_test(5ttgen/fsl_sgmamyghipp)
add_python_cmd_test(5ttgen/fsl_whitespace)
add_python_cmd_test(5ttgen/hsvs_aseg)
add_python_cmd_test(5ttgen/hsvs_default)
add_python_cmd_test(5ttgen/hsvs_first)
add_python_cmd_test(5ttgen/hsvs_modules)
add_python_cmd_test(5ttgen/hsvs_piping)
add_python_cmd_test(5ttgen/hsvs_template)
add_python_cmd_test(5ttgen/hsvs_whitespace)
add_python_cmd_test(5ttgen/hsvs_whitestem)

add_python_cmd_test(dwi2mask/3dautomask_default)
add_python_cmd_test(dwi2mask/3dautomask_options)
add_python_cmd_test(dwi2mask/3dautomask_piping)
add_python_cmd_test(dwi2mask/3dautomask_whitespace)
add_python_cmd_test(dwi2mask/ants_config)
add_python_cmd_test(dwi2mask/ants_piping)
add_python_cmd_test(dwi2mask/ants_template)
add_python_cmd_test(dwi2mask/ants_whitespace)
add_python_cmd_test(dwi2mask/b02template_antsfull_clioptions)
add_python_cmd_test(dwi2mask/b02template_antsfull_configfile)
add_python_cmd_test(dwi2mask/b02template_antsfull_configoptions)
add_python_cmd_test(dwi2mask/b02template_antsfull_template)
add_python_cmd_test(dwi2mask/b02template_antsquick_config)
add_python_cmd_test(dwi2mask/b02template_antsquick_template)
add_python_cmd_test(dwi2mask/b02template_fsl_default)
add_python_cmd_test(dwi2mask/b02template_fsl_flirtconfig)
add_python_cmd_test(dwi2mask/b02template_fsl_fnirtcnf)
add_python_cmd_test(dwi2mask/b02template_fsl_fnirtconfig)
add_python_cmd_test(dwi2mask/b02template_piping)
add_python_cmd_test(dwi2mask/b02template_whitespace)
add_python_cmd_test(dwi2mask/consensus_default "pythonci")
add_python_cmd_test(dwi2mask/consensus_piping)
add_python_cmd_test(dwi2mask/consensus_template)
add_python_cmd_test(dwi2mask/consensus_whitespace)
add_python_cmd_test(dwi2mask/fslbet_default)
add_python_cmd_test(dwi2mask/fslbet_options)
add_python_cmd_test(dwi2mask/fslbet_piping)
add_python_cmd_test(dwi2mask/fslbet_rescale)
add_python_cmd_test(dwi2mask/fslbet_whitespace)
add_python_cmd_test(dwi2mask/hdbet_default)
add_python_cmd_test(dwi2mask/hdbet_piping)
add_python_cmd_test(dwi2mask/hdbet_whitespace)
add_python_cmd_test(dwi2mask/legacy_default "pythonci")
add_python_cmd_test(dwi2mask/legacy_piping)
add_python_cmd_test(dwi2mask/legacy_whitespace)
add_python_cmd_test(dwi2mask/mean_default "pythonci")
add_python_cmd_test(dwi2mask/mean_piping)
add_python_cmd_test(dwi2mask/mean_whitespace)
add_python_cmd_test(dwi2mask/mtnorm_default "pythonci")
add_python_cmd_test(dwi2mask/mtnorm_initmask)
add_python_cmd_test(dwi2mask/mtnorm_lmax)
add_python_cmd_test(dwi2mask/mtnorm_piping)
add_python_cmd_test(dwi2mask/mtnorm_whitespace)
add_python_cmd_test(dwi2mask/synthstrip_default)
add_python_cmd_test(dwi2mask/synthstrip_options)
add_python_cmd_test(dwi2mask/synthstrip_piping)
add_python_cmd_test(dwi2mask/synthstrip_whitespace)
add_python_cmd_test(dwi2mask/trace_default "pythonci")
add_python_cmd_test(dwi2mask/trace_iterative)
add_python_cmd_test(dwi2mask/trace_piping)
add_python_cmd_test(dwi2mask/trace_whitespace)

add_python_cmd_test(dwi2response/dhollander_default)
add_python_cmd_test(dwi2response/dhollander_fslgrad "pythonci")
add_python_cmd_test(dwi2response/dhollander_grad)
add_python_cmd_test(dwi2response/dhollander_lmax)
add_python_cmd_test(dwi2response/dhollander_mask)
add_python_cmd_test(dwi2response/dhollander_piping)
add_python_cmd_test(dwi2response/dhollander_shells)
add_python_cmd_test(dwi2response/dhollander_whitespace)
add_python_cmd_test(dwi2response/dhollander_wmalgofa)
add_python_cmd_test(dwi2response/dhollander_wmalgotax)
add_python_cmd_test(dwi2response/dhollander_wmalgotournier)
add_python_cmd_test(dwi2response/fa_default)
add_python_cmd_test(dwi2response/fa_fslgrad "pythonci")
add_python_cmd_test(dwi2response/fa_grad)
add_python_cmd_test(dwi2response/fa_lmax)
add_python_cmd_test(dwi2response/fa_mask)
add_python_cmd_test(dwi2response/fa_piping)
add_python_cmd_test(dwi2response/fa_shells)
add_python_cmd_test(dwi2response/fa_threshold)
add_python_cmd_test(dwi2response/fa_whitespace)
add_python_cmd_test(dwi2response/manual_default)
add_python_cmd_test(dwi2response/manual_dirs)
add_python_cmd_test(dwi2response/manual_fslgrad "pythonci")
add_python_cmd_test(dwi2response/manual_grad)
add_python_cmd_test(dwi2response/manual_lmax)
add_python_cmd_test(dwi2response/manual_piping)
add_python_cmd_test(dwi2response/manual_shells)
add_python_cmd_test(dwi2response/manual_whitespace)
add_python_cmd_test(dwi2response/msmt5tt_default)
add_python_cmd_test(dwi2response/msmt5tt_dirs)
add_python_cmd_test(dwi2response/msmt5tt_fslgrad "pythonci")
add_python_cmd_test(dwi2response/msmt5tt_grad)
add_python_cmd_test(dwi2response/msmt5tt_lmax)
add_python_cmd_test(dwi2response/msmt5tt_mask)
add_python_cmd_test(dwi2response/msmt5tt_piping)
add_python_cmd_test(dwi2response/msmt5tt_sfwmfa)
add_python_cmd_test(dwi2response/msmt5tt_shells)
add_python_cmd_test(dwi2response/msmt5tt_whitespace)
add_python_cmd_test(dwi2response/msmt5tt_wmalgotax)
add_python_cmd_test(dwi2response/tax_default)
add_python_cmd_test(dwi2response/tax_fslgrad "pythonci")
add_python_cmd_test(dwi2response/tax_grad)
add_python_cmd_test(dwi2response/tax_lmax)
add_python_cmd_test(dwi2response/tax_mask)
add_python_cmd_test(dwi2response/tax_piping)
add_python_cmd_test(dwi2response/tax_shell)
add_python_cmd_test(dwi2response/tax_whitespace)
add_python_cmd_test(dwi2response/tournier_default)
add_python_cmd_test(dwi2response/tournier_fslgrad "pythonci")
add_python_cmd_test(dwi2response/tournier_grad)
add_python_cmd_test(dwi2response/tournier_lmax)
add_python_cmd_test(dwi2response/tournier_mask)
add_python_cmd_test(dwi2response/tournier_piping)
add_python_cmd_test(dwi2response/tournier_shell)
add_python_cmd_test(dwi2response/tournier_whitespace)

add_python_cmd_test(dwibiascorrect/ants_default)
add_python_cmd_test(dwibiascorrect/ants_mask)
add_python_cmd_test(dwibiascorrect/ants_piping)
add_python_cmd_test(dwibiascorrect/ants_whitespace)
add_python_cmd_test(dwibiascorrect/fsl_default)
add_python_cmd_test(dwibiascorrect/fsl_masked)
add_python_cmd_test(dwibiascorrect/fsl_piping)
add_python_cmd_test(dwibiascorrect/fsl_whitespace)
add_python_cmd_test(dwibiascorrect/mtnorm_default "pythonci")
add_python_cmd_test(dwibiascorrect/mtnorm_lmax)
add_python_cmd_test(dwibiascorrect/mtnorm_masked)
add_python_cmd_test(dwibiascorrect/mtnorm_piping)
add_python_cmd_test(dwibiascorrect/mtnorm_whitespace)

add_python_cmd_test(dwibiasnormmask/default "pythonci")
add_python_cmd_test(dwibiasnormmask/lmax)
add_python_cmd_test(dwibiasnormmask/maxiters)
add_python_cmd_test(dwibiasnormmask/piping)
add_python_cmd_test(dwibiasnormmask/reference)
add_python_cmd_test(dwibiasnormmask/scaled)
add_python_cmd_test(dwibiasnormmask/whitespace)

add_python_cmd_test(dwicat/3dimage)
add_python_cmd_test(dwicat/default_ownbzero "pythonci")
add_python_cmd_test(dwicat/default_sharedbzero)
add_python_cmd_test(dwicat/nointensity)
add_python_cmd_test(dwicat/piping)
add_python_cmd_test(dwicat/rigidbody)
add_python_cmd_test(dwicat/whitespace)

add_python_cmd_test(dwifslpreproc/axis_padding)
add_python_cmd_test(dwifslpreproc/eddyqc)
add_python_cmd_test(dwifslpreproc/permuted_volumes)
add_python_cmd_test(dwifslpreproc/piping)
add_python_cmd_test(dwifslpreproc/rpeall)
add_python_cmd_test(dwifslpreproc/rpeheader_none)
add_python_cmd_test(dwifslpreproc/rpeheader_onerevbzero)
add_python_cmd_test(dwifslpreproc/rpeheader_rpepair)
add_python_cmd_test(dwifslpreproc/rpenone_default)
add_python_cmd_test(dwifslpreproc/rpepair_alignseepi)
add_python_cmd_test(dwifslpreproc/rpepair_default)
add_python_cmd_test(dwifslpreproc/whitespace)

add_python_cmd_test(dwigradcheck/default)
add_python_cmd_test(dwigradcheck/piping)
add_python_cmd_test(dwigradcheck/whitespace)

add_python_cmd_test(dwinormalise/group_default "pythonci")
add_python_cmd_test(dwinormalise/group_piping)
add_python_cmd_test(dwinormalise/group_whitespace)
add_python_cmd_test(dwinormalise/manual_default "pythonci")
add_python_cmd_test(dwinormalise/manual_percentile)
add_python_cmd_test(dwinormalise/manual_piping)
add_python_cmd_test(dwinormalise/manual_whitespace)
add_python_cmd_test(dwinormalise/mtnorm_default "pythonci")
add_python_cmd_test(dwinormalise/mtnorm_lmax)
add_python_cmd_test(dwinormalise/mtnorm_masked)
add_python_cmd_test(dwinormalise/mtnorm_piping)
add_python_cmd_test(dwinormalise/mtnorm_reference)
add_python_cmd_test(dwinormalise/mtnorm_scaled)
add_python_cmd_test(dwinormalise/mtnorm_whitespace)

add_python_cmd_test(dwishellmath/default "pythonci")
add_python_cmd_test(dwishellmath/oneshell)
add_python_cmd_test(dwishellmath/piping)
add_python_cmd_test(dwishellmath/whitespace)

add_python_cmd_test(for_each/echo "pythonci")
add_python_cmd_test(for_each/exclude "pythonci")
add_python_cmd_test(for_each/parallel "pythonci")

add_python_cmd_test(labelsgmfirst/default)
add_python_cmd_test(labelsgmfirst/freesurfer)
add_python_cmd_test(labelsgmfirst/piping)
add_python_cmd_test(labelsgmfirst/premasked)
add_python_cmd_test(labelsgmfirst/sgm_amyg_hipp)
add_python_cmd_test(labelsgmfirst/whitespace)

add_python_cmd_test(mask2glass/default "pythonci")
add_python_cmd_test(mask2glass/no4dseries "pythonci")
add_python_cmd_test(mask2glass/piping)
add_python_cmd_test(mask2glass/whitespace)

add_python_cmd_test(mrtrix_cleanup/default "pythonci")
add_python_cmd_test(mrtrix_cleanup/test "pythonci")
add_python_cmd_test(mrtrix_cleanup/whitespace)

add_python_cmd_test(population_template/fa_affine)
add_python_cmd_test(population_template/fa_affinenonlinear)
add_python_cmd_test(population_template/fa_default "pythonci")
add_python_cmd_test(population_template/fa_initaligngeometric)
add_python_cmd_test(population_template/fa_initalignnone)
add_python_cmd_test(population_template/fa_masked)
add_python_cmd_test(population_template/fa_nonlinear)
add_python_cmd_test(population_template/fa_rigid)
add_python_cmd_test(population_template/fa_rigidaffine)
add_python_cmd_test(population_template/fa_rigidnonlinear)
add_python_cmd_test(population_template/fa_voxelsize)
add_python_cmd_test(population_template/fod_default "pythonci")
add_python_cmd_test(population_template/fod_options)
add_python_cmd_test(population_template/piping)
add_python_cmd_test(population_template/whitespace)

add_python_cmd_test(responsemean/default "pythonci")
add_python_cmd_test(responsemean/legacy "pythonci")
add_python_cmd_test(responsemean/whitespace "pythonci")

