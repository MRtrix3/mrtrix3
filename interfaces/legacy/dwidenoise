dMRI noise level estimation and denoising using Marchenko-Pastur PCA
DWI data denoising and noise map estimation by exploiting data redundancy in the PCA domain using the prior knowledge that the eigenspectrum of random covariance matrices is described by the universal Marchenko-Pastur (MP) distribution. Fitting the MP distribution to the spectrum of patch-wise signal matrices hence provides an estimator of the noise level 'sigma', as was first shown in Veraart et al. (2016) and later improved in Cordero-Grande et al. (2019). This noise level estimate then determines the optimal cut-off for PCA denoising.
Important note: image denoising must be performed as the first step of the image processing pipeline. The routine will fail if interpolation or smoothing has been applied to the data prior to denoising.
Note that this function does not correct for non-Gaussian noise biases present in magnitude-reconstructed MRI images. If available, including the MRI phase data can reduce such non-Gaussian biases, and the command now supports complex input data.
ARGUMENT dwi 0 0 IMAGEIN
the input diffusion-weighted image.
ARGUMENT out 0 0 IMAGEOUT
the output denoised DWI image.
OPTION mask 1 0
Only process voxels within the specified binary brain mask image.
ARGUMENT image 0 0 IMAGEIN
OPTION extent 1 0
Set the patch size of the denoising filter. By default, the command will select the smallest isotropic patch size that exceeds the number of DW images in the input data, e.g., 5x5x5 for data with <= 125 DWI volumes, 7x7x7 for data with <= 343 DWI volumes, etc.
ARGUMENT window 0 0 ISEQ
OPTION noise 1 0
The output noise map, i.e., the estimated noise level 'sigma' in the data. Note that on complex input data, this will be the total noise level across real and imaginary channels, so a scale factor sqrt(2) applies.
ARGUMENT level 0 0 IMAGEOUT
OPTION rank 1 0
The selected signal rank of the output denoised image.
ARGUMENT cutoff 0 0 IMAGEOUT
OPTION datatype 1 0
Datatype for the eigenvalue decomposition (single or double precision). For complex input data, this will select complex float32 or complex float64 datatypes.
ARGUMENT float32/float64 0 0 CHOICE float32 float64
OPTION estimator 1 0
Select the noise level estimator (default = Exp2), either: 
* Exp1: the original estimator used in Veraart et al. (2016), or 
* Exp2: the improved estimator introduced in Cordero-Grande et al. (2019).
ARGUMENT Exp1/Exp2 0 0 CHOICE exp1 exp2
OPTION info 1 0
display information messages.
OPTION quiet 1 0
do not display information messages or progress status; alternatively, this can be achieved by setting the MRTRIX_QUIET environment variable to a non-empty string.
OPTION debug 1 0
display debugging messages.
OPTION force 1 0
force overwrite of output files (caution: using the same file as input and output might cause unexpected behaviour).
OPTION nthreads 1 0
use this number of threads in multi-threaded applications (set to 0 to disable multi-threading).
ARGUMENT number 0 0 INT 0 9223372036854775807
OPTION config 1 1
temporarily set the value of an MRtrix config file entry.
ARGUMENT key 0 0 TEXT
ARGUMENT value 0 0 TEXT
OPTION help 1 0
display this information page and exit.
OPTION version 1 0
display version information and exit.
