version: 1.0.{build}

image: Visual Studio 2017

platform: x64

configuration: Release

clone_folder: c:\msys64\mrtrix3

shallow_clone: true
clone_depth: 5

matrix:
  fast_finish: false

environment:
  matrix:
    - PYTHON: python2
    - PYTHON: python3

init:
  - git config --global core.autocrlf input
  - cmd: C:\msys64\msys2_shell.cmd -mingw64 -c "cd /mrtrix3/ && echo 0 > success.status"

build: off

build_script:
  - cmd: C:\msys64\msys2_shell.cmd -mingw64 -c "pacman -S --noconfirm bc mingw-w64-x86_64-diffutils mingw-w64-x86_64-eigen3 mingw-w64-x86_64-qt5 mingw-w64-x86_64-fftw mingw-w64-x86_64-libtiff"
# - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
  - cmd: C:\msys64\msys2_shell.cmd -mingw64 -c "cd /mrtrix3/ && $PYTHON ./configure -assert; echo $? > configure.status"
  - cmd: C:\msys64\msys2_shell.cmd -mingw64 -c "cd /mrtrix3/ && $PYTHON ./build -nowarnings -persistent -nopaginate; echo $? > build.status"

test_script:
  - cmd: C:\msys64\msys2_shell.cmd -mingw64 -c "cd /mrtrix3/ && ./run_tests; echo $? > testing.status"
  - cmd: fc configure.status success.status
  - cmd: fc build.status success.status
  - cmd: fc testing.status success.status

artifacts:
  - path: configure.log
  - path: build.log
  - path: testing.log
